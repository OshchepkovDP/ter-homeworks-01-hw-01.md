# Домашнее задание к занятию "`#«Введение в Terraform» - Ощепков Дмитрий`"

### Инструкция по выполнению домашнего задания

1. Сделайте fork [репозитория c шаблоном решения](https://github.com/netology-code/sys-pattern-homework) к себе в Github и переименуйте его по названию или номеру занятия, например, https://github.com/имя-вашего-репозитория/gitlab-hw или https://github.com/имя-вашего-репозитория/8-03-hw).
2. Выполните клонирование этого репозитория к себе на ПК с помощью команды `git clone`.
3. Выполните домашнее задание и заполните у себя локально этот файл README.md:
   - впишите вверху название занятия и ваши фамилию и имя;
   - в каждом задании добавьте решение в требуемом виде: текст/код/скриншоты/ссылка;
   - для корректного добавления скриншотов воспользуйтесь инструкцией [«Как вставить скриншот в шаблон с решением»](https://github.com/netology-code/sys-pattern-homework/blob/main/screen-instruction.md);
   - при оформлении используйте возможности языка разметки md. Коротко об этом можно посмотреть в [инструкции по MarkDown](https://github.com/netology-code/sys-pattern-homework/blob/main/md-instruction.md).
4. После завершения работы над домашним заданием сделайте коммит (`git commit -m "comment"`) и отправьте его на Github (`git push origin`).
5. Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
6. Любые вопросы задавайте в чате учебной группы и/или в разделе «Вопросы по заданию» в личном кабинете.

Желаем успехов в выполнении домашнего задания.
---

### Задание 1

Перейдите в каталог src. Скачайте все необходимые зависимости, использованные в проекте.
Изучите файл .gitignore. В каком terraform-файле, согласно этому .gitignore, допустимо сохранить личную, секретную информацию?(логины,пароли,ключи,токены итд)
Выполните код проекта. Найдите в state-файле секретное содержимое созданного ресурса random_password, пришлите в качестве ответа конкретный ключ и его значение.
Раскомментируйте блок кода, примерно расположенный на строчках 29–42 файла main.tf. Выполните команду terraform validate. Объясните, в чём заключаются намеренно допущенные ошибки. Исправьте их.
Выполните код. В качестве ответа приложите: исправленный фрагмент кода и вывод команды docker ps.
Замените имя docker-контейнера в блоке кода на hello_world. Не перепутайте имя контейнера и имя образа. Мы всё ещё продолжаем использовать name = "nginx:latest". Выполните команду terraform apply -auto-approve. Объясните своими словами, в чём может быть опасность применения ключа -auto-approve. Догадайтесь или нагуглите зачем может пригодиться данный ключ? В качестве ответа дополнительно приложите вывод команды docker ps.
Уничтожьте созданные ресурсы с помощью terraform. Убедитесь, что все ресурсы удалены. Приложите содержимое файла terraform.tfstate.
Объясните, почему при этом не был удалён docker-образ nginx:latest. Ответ ОБЯЗАТЕЛЬНО НАЙДИТЕ В ПРЕДОСТАВЛЕННОМ КОДЕ, а затем ОБЯЗАТЕЛЬНО ПОДКРЕПИТЕ строчкой из документации terraform провайдера docker. (ищите в классификаторе resource docker_image )

Ответ:

После изучения файла .gitignore, на основании строки ** # own secret vars store. personal.auto.tfvars**, я пришёл к выводу, что секретную информацию можно хранить в файле personal.auto.tfvars

В state-файле мы можем увидеть ключ result с содержимым mhk4FXqFPGbSr0Pj

В строке кода resource "docker_image" не было указано имя, что противоречит правилам. После обнаружения проблемы, было добавлено имя "nginx" В строке кода resource "docker_container" "nginx" имя ресурса начиналось с цифры, что недопустимо. Было исправлено на "nginx" В строке кода name = "example_${random_password.random_string_FAKE.resulT}" имя ресурса противоречит уже прописанному ранее в конфигурации ресурсу с именем "random_password" "random_string" Так же, в атрибуте resulT стоит заглавная Т, а terraform чувствителен к регистру. Иправлено на name = "example_${random_password.random_string.result}" После исправления данных ошибок, делаем повторную проверку и получаем: terraform validate Success! The configuration is valid

Выполнение исправленного кода

![terraform main.tf.jpg](83MYgnuLYNAKaiBaYHepTCgSL9SrB1H78EGtdY1uzmkcQJqv27tDdCpBSczcJDrpfMBnXL4wHsqJVchH6X4nxdem7DU12Fc)
![Docker_ps.jpg](https://github.com/OshchepkovDP/ter-homeworks-01-hw-01.md/blob/main/img/Docker_ps.jpg)

Замена имени docker-контейнера

![Docker_hello_world.jpg](https://github.com/OshchepkovDP/ter-homeworks-01-hw-01.md/blob/main/img/Docker_hello_world.jpg)

Опасность использования -auto-approve:

- возможность случайно уничтожить продакшн инфраструктуру
- риск применения некорректных изменений
- различные мелкие ошибки, которые могут возникнуть в следствии сборки инфраструктуры из не проверенного кода Возможная польза использования -auto-approve:
- быстрая сборка большого количества изменений
- использование в скриптах, где не требуется участие человека
- в ситуациях когда требуется быстро применять изменения
- при первичной настройке инфраструктуры

Уничтожение ресурсов terraform с содержимым файла terraform.tfstate после удаления:

![terraform_destroy.jpg](https://github.com/OshchepkovDP/ter-homeworks-01-hw-01.md/blob/main/img/terraform_destroy.jpg)


В строке кода присутствует параметр keep_locally. Вот, что об этом параметре пишут в документации Docker

```
If this is false, it will delete the image from the docker local storage on destroy operation.
```

Таким образом, параметр keep_locally при значение true не позволяет удалять образы с локального хоста при уничтожении ресурсов terraform.

